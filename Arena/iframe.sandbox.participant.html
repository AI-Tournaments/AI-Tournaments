<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Participant (IFrame)</title>
		<meta content="width=device-width, initial-scale=1.0" name="viewport">
		<meta content="yes" name="mobile-web-app-capable">
		<script src="https://ai-tournaments.github.io/AI-Tournaments/Arena/ArenaHelper.js"></script>
		<script>
			'use strict'
			let _parent = null;
			function a(){
				function isIframe(){
					try{
						return window.self !== window.top;
					}catch(e){
						return true;
					}
				}
				if(!isIframe()){
					window.location.replace(window.location.href.replace('\/(?:.(?!\/))+$', '/'));
				}else{
					function addWorker(data){
						let id = 'worker-'+data.name;
						let iframe = document.getElementById(id);
						if(iframe !== null){
							throw new Error('Participant-worker "'+data.name+'" already exist!');
						}
						iframe = document.createElement('iframe');
						iframe.id = id;
						iframe.src = 'iframe.sandbox.participantworker.html#'+JSON.stringify({url: location.hash.substring(1), name: data.name, participant: data.participant});
						iframe.sandbox = 'allow-scripts';
						document.body.appendChild(iframe);
						setTimeout(()=>{
							iframe.contentWindow.postMessage(data.workerData, '*');
						},1000);
					}
					window.onmessage = messageEvent => {
						if(_parent === null){
							_parent = messageEvent.source;
						}
						switch(messageEvent.data.type){
							default:
								_parent.postMessage(messageEvent.data, '*');
								break;
							case 'Add-Worker':
								addWorker(messageEvent.data.data);
								break;
							case 'Event':
								_parent.postMessage({type: 'Event', payload: messageEvent.data.payload}, '*');
								break;
						}
					}
				}
			}
		</script>
	</head>
	<body onload="a()"></body>
</html>
