<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>X Arena</title>
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-173346924-1"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'UA-173346924-1');</script>
		<meta content="width=device-width, initial-scale=1.0" name="viewport">
		<meta content="yes" name="mobile-web-app-capable">
		<style>
			html, body, iframe {
				margin: 0;
				padding: 0;
				border: 0;
				width: 100%;
				height: 100%;
			}
		</style>
		<script src="https://chrisacrobat.github.io/js-compilation/CreateWorkerFromRemoteURL.js"></script>
		<script>
			'use strict'
			var participantsToFetch = 0;
			function onload(){
				let settings = { // TEMP
					arena: 'Kalaha',
					participants: [],
					settings: {
						boardLength: 6,
						startValue: 4,
						averageOf: 4,
						rules: []
					}
				};
				fetch('https://api.github.com/repos/AI-Tournaments/Kalaha-AI-Tournament-Participant/forks')
				.then(response => response.json())
				.then(forks => {
					forks.forEach(fork => {
						participantsToFetch++;
						document.title = document.title.replace('X', settings.arena);
						fetch('https://api.github.com/repos/' + fork.full_name + '/git/trees/master')
						.then(response => response.json())
						.then(data => {
							data.tree.forEach(file =>{
								if(file.path.endsWith('.js')){
									settings.participants.push('https://raw.githubusercontent.com/' + fork.full_name + '/' + fork.default_branch + '/' + file.path); // TODO: This should be manually input in settings, so limited tournaments can be arranged.
								}
							});
							settings.participants = settings.participants.slice(2); // TEMP: During dev.
							participantsToFetch--;
							if(participantsToFetch == 0){
								let iframe = document.createElement('iframe');
								iframe.src = 'iframe.html#' + JSON.stringify(settings);
								iframe.sandbox = 'allow-scripts';
								iframe.style.display = 'none';
								document.body.appendChild(iframe);
							}
						})
						.catch(error => {
							console.error(error);
							participantsToFetch--;
						});
					});
				});
			}
		</script>
	</head>
	<body onload="onload()"></body>
</html>
