<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>X Arena</title>
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-173346924-1"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'UA-173346924-1');</script>
		<meta content="width=device-width, initial-scale=1.0" name="viewport">
		<meta content="yes" name="mobile-web-app-capable">
		<script src="https://chrisacrobat.github.io/js-compilation/CreateWorkerFromRemoteURL.js"></script>
		<script>
			'use strict'
			var participantsToFetch = 0;
			function onload(){
				let settings = {
					arena: 'Kalaha',
					participants: [],
					settings: {
						boardLength: 6,
						startValue: 4,
						matchs: 1,
						rules: []
					}
				};
				document.title = document.title.replace('X', settings.arena);
				fetch('https://api.github.com/repos/AI-Tournaments/Kalaha-AI-Tournament-Participant/forks')
				.then(response => response.json())
				.then(forks => {
					forks.forEach(fork => {
						participantsToFetch++;
						fetch('https://api.github.com/repos/' + fork.full_name + '/git/trees/master')
						.then(response => response.json())
						.then(data => {
							data.tree.forEach(file =>{
								if(file.path.endsWith('.js')){
									settings.participants.push('https://raw.githubusercontent.com/' + fork.full_name + '/' + fork.default_branch + '/' + file.path); // TODO: This should be manually input input, so limited tournaments can be arranged.
								}
							});
							participantsToFetch--;
							if(participantsToFetch == 0){
								let sandbox = document.getElementById('sandbox');
								sandbox.srcdoc = sandbox.srcdoc.replace('DATA', JSON.stringify(settings).replace(/"/g, '\\"'));
							}
						})
						.catch(error => {
							console.error(error);
							participantsToFetch--;
						});
					});
				});
			}
		</script>
	</head>
	<body onload="onload()">
		<input type="button" style="float: left;" value="Rerun">
		<input type="button" style="float: left;" value="Copy output">
		<iframe id="sandbox" style="float: left; clear: both;" sandbox="allow-scripts" srcdoc='
			<!DOCTYPE html>
			<html>
				<head>
					<meta charset="UTF-8">
					<title>X Arena (IFrame)</title>
					<meta content="width=device-width, initial-scale=1.0" name="viewport">
					<meta content="yes" name="mobile-web-app-capable">
					<script src="https://chrisacrobat.github.io/js-compilation/CreateWorkerFromRemoteURL.js"></script>
					<script>
						"use strict"
						let data = "DATA";
						if(data !== "DA"+"TA"){
							data = JSON.parse(data);
							document.title = document.title.replace("X", data.arena);
							if(data.arena !== undefined){
								createWorkerFromRemoteURL("https://raw.githubusercontent.com/AI-Tournaments/GAME-Arena/master/arena.js".replace("GAME", data.arena), true).then(worker => {
									worker.onmessage = messageEvent => {
										document.body.innerHTML += "<pre id=\"" + messageEvent.data.id + "\">" + JSON.stringify(messageEvent.data, 0, 4) + "</pre>";
									};
									//for each match:
										worker.postMessage({arena: data, id: 0});
								});
							}else{
								document.body.innerHTML = "No arena defined.";
							}
						}
					</script>
				</head>
				<body></body>
			</html>
		'></iframe>
	</body>
</html>
