<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>X Arena</title>
		<meta content="width=device-width, initial-scale=1.0" name="viewport">
		<meta content="yes" name="mobile-web-app-capable">
		<script src="https://chrisacrobat.github.io/js-compilation/CreateWorkerFromRemoteURL.js"></script>
		<script>
			'use strict'
			var participantsToFetch = 0;
			function onload(){
				let settings = {
					arena: 'Kalaha',
					participants: [],
					settings: {
						boardLength: 6,
						startValue: 4,
						matchs: 1,
						rules: []
					}
				};
				fetch('https://api.github.com/repos/AI-Tournaments/Kalaha-AI-Tournament-Participant/forks')
				.then(response => response.json())
				.then(forks => {
					forks.forEach(fork => {
						participantsToFetch++;
						fetch('https://api.github.com/repos/' + fork.full_name + '/git/trees/master')
						.then(response => response.json())
						.then(data => {
							data.tree.forEach(file =>{
								if(file.path.endsWith('.js')){
									settings.participants.push(file.path); // TODO: This should be manually input input, so limited tournaments can be arranged.
								}
							});
							participantsToFetch--;
							if(participantsToFetch == 0){
								document.title = document.title.replace('X', settings.arena);
								let iframe = document.createElement('iframe');
								iframe.src = 'iframe.html#' + JSON.stringify(settings);
								iframe.sandbox = 'allow-scripts';
								document.body.appendChild(iframe);
							}
						})
						.catch(error => {
							console.error(error);
							participantsToFetch--;
						});
					});
				});
			}
		</script>
	</head>
	<body onload="onload()"></body>
</html>
